> 참고: 가상 면접 사례로 배우는 대규모 시스템 설계 기초 > 뉴스 피드 시스템 설계

## 설계 범위 확정
* 게시글을 올릴 수 있어야 하고 친구들이 올린 게시글을 볼 수 있어야 한다.
* 게시글은 시간 역순으로 표시된다.
* 한명의 사용자는 최대 5000명의 친구를 가질 수 있다
* 트래픽 규모는 매일 천만명이 방문한다.
* 게시글에는 이미지나 비디오 등의 미디어 파일이 포함될 수 있다.

## 개략적인 설계안 제시
* 게시글 발행 : 게시글을 올리면 해당 데이터를 캐시, DB에 저장 후 친구의 뉴스피드에도 전송
* 피드 조회 : 모든 친구의 포스팅을 시간 흐름 역순으로 모아 노출

## 게시글 업로드 API
`[POST] /v1/me/feed`

인자
* 바디(body): 포스팅 내용
* Authorization 헤더 : API 호출 인증

**설계**

* 처리율 제한: 서버는 스팸을 막고 유해한 콘텐츠가 자주 올라오는 것을 방지하기 위해 특정 기간동안 한 사용자가 올릴 수 있는 포스팅의 수에 제한을 둘 수 있다.
* 새 게시글을 데이터베이스와 캐시에 저장한다.
* 새 게시글을 타인의 피드에 전송(**팬아웃**)
  * 새 게시글을 그 사용자와 친구 관계에 있는 모든 사람들에게 전달한다.

## 홈 피드 API
`[GET] /v1/me/feed`
* 캐시에서 홈 피드를 가져온다.
  * 홈 피드를 렌더링할 때 필요한 피드 id를 보관한다.

## 포스트 전송(팬아웃 서비스)
**팬아웃에는 두 가지 방식이 있다.**

(1) 쓰기 시점에 팬아웃
* 새로운 게시글이 작성되는 시점에 친구들 홈 피드 캐시에 해당 포스팅을 기록한다.
* (+) 새 게시글이 기록되는 순간에 피드가 갱신되므로 뉴스 피드를 읽는데 드는 시간이 짧아지지만
* (-) 친구가 많은 경우 친구 목록을 가져오고 그 친구들의 피드를 갱신하는데 많은 시간이 소요될 수 있다.
* (-) 서비스를 자주 이용하지 않는 사용자의 피드까지 갱신해야 하므로 컴퓨팅 자원이 낭비된다.

(2) 읽기 시점에 팬아웃
* 피드를 읽어햐 하는 시점에 피드를 갱신한다.
* (+) 비활성 사용자의 경우 이 모델이 유리하다
* (-) 홈 피드를 읽는데 많은 시간이 소요될 수 있다.

## 팬아웃 설계
