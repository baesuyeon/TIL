> 참고: 가상 면접 사례로 배우는 대규모 시스템 설계 기초 > 사용자 수에 따른 규모 확장성

대규모 시스템 설계에서 가장 중요한 과제 중 하나는 사용자 증가에 따른 트래픽, 데이터, 요청 처리량의 증가에 어떻게 대응하느냐이다.

## 데이터베이스 선택: 관계형 vs 비관계형
비관계형 데이터베이스(NoSQL)가 적합한 경우
* 낮은 응답 지연시간(latency)이 중요할 때
* 데이터 구조가 비정형일 때 (관계형 스키마로 표현하기 어려울 때)
* 아주 많은 데이터를 저장할 필요가 있을 때

## 수직적 규모 확장 vs 수평적 규모 확장
* 수직적 규모 확장에는 한계가 있다. 한 대의 서버에 CPU나 메모리를 무한대로 증설할 방법이 없다.
* 한 대의 서버에 장애가 발생하면 서비스가 완전히 중단된다.

## 로드밸런서
```
Client ─▶ Load Balancer ─▶ [ Server1 | Server2 | Server3 ... ]
```
load balancing set에 속한 서버들에게 트래픽 부하를 고르게 분산하는 역할을 한다.
클라이언트는 서버에 직접 접속하지 않고 로드밸런서의 공개 IP 주소(public IP address)로 접속한다.

서버간 통신에는 사설 IP 주소(private IP address)가 이용된다.
사설 IP 주소는 같은 네트워크에 속한 서버 사이의 통신에만 쓰일 수 있는 IP 주소로 인터넷을 통해서는 접속할 수 없다.
로드밸런서는 웹 서버와 통신하기 위해 이 사설 주소를 이용한다.

* 서버 1, 서버2가 있다고 가정한다.
* 서버 1이 다운되면 모든 트래픽은 서버 2로 전송된다.
* 트래픽이 가파르게 증가하면 load balancing set에 더 많은 서버를 추가한다. 그러면 로드밸런서가 자동으로 트래픽을 분산한다.
대표 기술: Nginx

## 데이터베이스 다중화 (Replication)
서버가 다중화되었다고 하더라도 데이터베이스 서버가 한 대라면 병목이 발생한다.
이를 해결하기 위해 master-slave 구조의 복제(replication)을 사용한다.
쓰기 연산은 master에만 지원하고 slave는 읽기연산만 지원하여 데이터 원본은 master 서버에, 사본은 slave 서버에 저장한다.

동작 방식
* master: 쓰기 연산(INSERT, UPDATE, DELETE) 처리
* slave: 읽기 전용(SELECT) 처리
* master의 변경 사항은 주기적으로 slave로 전파

데이터베이스 다중화 이점
* 읽기 요청을 여러 slave로 분산하여 처리량이 증가한다.
* 데이터베이스 서버에 장애가 발생하더라도 데이터가 보존된다.
* 데이터베이스 서버에 장애가 발생하더라도 다른 서버에 있는 데이터를 가져와 서비스를 이어갈 수 있다.

master 데이터베이스 서버가 다운되면 slave 데이터베이스 서버가 새로운 master 서버가 된다.
단 승격 시점에 복제 지연이 있었다면 일부 최신 데이터가 누락될 수 있다. (복구 스크립트를 통해 누락 데이터를 보정해야 한다)

최종 동작 방식
* 클라이언트는 DNS로부터 로드밸런서의 공개 IP 주소를 받는다.
* 사용자는 해당 IP 주소를 사용해 로드밸런서에 접속한다.
* 로드밸런서는 여러 서버 중 하나로 요청을 전달한다.
* 서버는 요청을 slave(읽기) 또는 master(쓰기) 데이터베이스로 전달한다.